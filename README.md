# Factorio Item Browser - API Import

[![Latest Stable Version](https://poser.pugx.org/factorio-item-browser/api-import/v/stable)](https://packagist.org/packages/factorio-item-browser/api-import)
[![License](https://poser.pugx.org/factorio-item-browser/api-import/license)](https://packagist.org/packages/factorio-item-browser/api-import)
[![Build Status](https://travis-ci.com/factorio-item-browser/api-import.svg?branch=master)](https://travis-ci.com/factorio-item-browser/api-import)
[![codecov](https://codecov.io/gh/factorio-item-browser/api-import/branch/master/graph/badge.svg)](https://codecov.io/gh/factorio-item-browser/api-import)

This project imports the data generated by the export into the database of the API server.

_**Note:** The production server of the Factorio Item Browser does not support PHP CLI, so this project implements a simple
HTTP interface to allow access to the actions, secured by API keys. Ideally these would be commands only runnable with
SSH access on the server._ 

After the export files have been uploaded to the configured directory, the following routes must be called to import
all the data:

#### Mod import:

The starting point of the import is importing the mods. For each mod which must be updated in the database the 
following routes must be executed *in order*. The `<modName>` must be replaced with the internal name of the mod to be
imported.

* `/mod/<modName>`: Imports the basic meta data of the mod.
* `/mod/<modName>/combinations`: Adds all the combinations to the database to be imported next.
* `/mod/<modName>/dependencies`: Adds the meta data of the dependencies of the mod to the database.
* `/mod/<modName>/translations`: Adds the translations of the meta data of the mod to the database, i.e. titles and
  descriptions.
   
#### Combination import:
 
For each combination of a newly imported or updated mod the following routes must be called *in order*. The 
`<combinationHash>` must be replaced with the hash value as used in the export data.
 
* `/combination/<combinationHash>/items`: Imports all the items used by the combination into the database.
* `/combination/<combinationHash>/crafting-categories`: Imports the crafting categories used by the combination into
  the database.
* `/combination/<combinationHash>/machines`: Imports the machine data of the combination into the database.
* `/combination/<combinationHash>/recipes`: Imports the recipe data of the combination into the database.
* `/combination/<combinationHash>/translations`: Imports all the translations of the combination into the database.
* `/combination/<combinationHash>/icons`: Imports the icon files of the combination into the database.

#### Database cleanups:

After all mods have been imported, there are some cleanup routes to be called *in order*. These routes can be called 
once after all other mod and combination routes have been executed to finish up the import.

* `/cleanup`: Cleans up any data from the database which is no longer used by any mod or combination.
* `/order/mods`: Re-assigns the order values to all mods.
* `/order/combinations`: Re-assigns the order values to all combinations.
* `/clear-cache`: Clears the caches of the database, i.e. the cache of the search results. 
